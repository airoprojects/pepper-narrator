<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Select Players</title>
</head>
<body>
    <h1>Players List</h1>
    <div id="playersList"></div>

    <script>
        // Sample function to simulate fetching players from a server FLASK
        function fetchPlayers() {
            return [
                { id: 1, name: 'Player One' },
                { id: 2, name: 'Player Two' },
                { id: 3, name: 'Player Three' },
            ];
        }

        function generatePlayerButtons(players) {
            const playersListDiv = document.getElementById('playersList');
            playersListDiv.innerHTML = ''; // Clear previous content
            players.forEach(player => {
                const button = document.createElement('button');
                button.textContent = player.name;
                button.onclick = () => {
                    window.location.href = `player.html?id=${player.id}`;
                };
                playersListDiv.appendChild(button);
            });
        }


        async function fetchStatus() {
            try {
                const response = await fetch('http://127.0.0.1:5000/request_status');
                const data = await response.json();
                return data.game_status;
            } catch (error) {
                console.error('Error:', error);
                return 'inactive'; // Default to 'inactive' on error
            }
        }

        async function checkGameStatus() {
            const players = fetchPlayers();
            let game_status = await fetchStatus();
            console.log(game_status);
            
            if (game_status === 'active') {
                generatePlayerButtons(players);
            } else {
                const welcome_text = document.getElementById('playersList');
                welcome_text.innerHTML = ''; // Clear previous content
                welcome_text.appendChild(document.createTextNode('Hello Tabula'));
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            checkGameStatus(); // Check the status immediately when the page loads
            setInterval(checkGameStatus, 5000); // Check the status every 5 seconds
        });
    </script>
</body>
</html>
